{
  "entities": {
    "Shipment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Shipment",
      "type": "object",
      "description": "Represents a shipment with its key details and journey.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Shipment entity."
        },
        "scanCode": {
          "type": "string",
          "description": "The scan code associated with the shipment."
        },
        "company": {
          "type": "string",
          "description": "The company responsible for the shipment."
        },
        "serviceType": {
          "type": "string",
          "description": "The type of service used for the shipment (e.g., express, standard)."
        },
        "status": {
          "type": "string",
          "description": "The current status of the shipment (e.g., in transit, delivered)."
        }
      },
      "required": [
        "id",
        "scanCode",
        "company",
        "serviceType",
        "status"
      ]
    },
    "ShipmentNode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShipmentNode",
      "type": "object",
      "description": "Represents a stage or node in the shipment's journey.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ShipmentNode entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the shipment stage (e.g., Origin Scan, Departure Scan)."
        },
        "expectedDate": {
          "type": "string",
          "description": "The expected date for this shipment stage.",
          "format": "date-time"
        },
        "actualDate": {
          "type": "string",
          "description": "The actual date when this shipment stage occurred.",
          "format": "date-time"
        },
        "delay": {
          "type": "number",
          "description": "The delay in days for this shipment stage."
        },
        "isCritical": {
          "type": "boolean",
          "description": "Indicates whether this node is on the critical path."
        }
      },
      "required": [
        "id",
        "name",
        "expectedDate"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a user comment associated with a delayed shipment node.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Comment entity."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who created the comment."
        },
        "text": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "text",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/shipments/{shipmentId}",
        "definition": {
          "entityName": "Shipment",
          "schema": {
            "$ref": "#/backend/entities/Shipment"
          },
          "description": "Stores shipment details. Publicly readable.",
          "params": [
            {
              "name": "shipmentId",
              "description": "The unique identifier of the shipment."
            }
          ]
        }
      },
      {
        "path": "/shipments/{shipmentId}/shipment_nodes/{shipmentNodeId}",
        "definition": {
          "entityName": "ShipmentNode",
          "schema": {
            "$ref": "#/backend/entities/ShipmentNode"
          },
          "description": "Stores shipment node details for a specific shipment. Publicly readable.",
          "params": [
            {
              "name": "shipmentId",
              "description": "The unique identifier of the shipment."
            },
            {
              "name": "shipmentNodeId",
              "description": "The unique identifier of the shipment node."
            }
          ]
        }
      },
      {
        "path": "/shipments/{shipmentId}/shipment_nodes/{shipmentNodeId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for a specific shipment node. Readable by all, writable by owner.",
          "params": [
            {
              "name": "shipmentId",
              "description": "The unique identifier of the shipment."
            },
            {
              "name": "shipmentNodeId",
              "description": "The unique identifier of the shipment node."
            },
            {
              "name": "commentId",
              "description": "The unique identifier of the comment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed for collaboration and security. Shipments and their nodes are public to allow tracking. Comments are nested under the specific shipment node they relate to, which is a natural and efficient way to query them. Anonymous authentication is enabled to allow any user to contribute, but security rules ensure that users can only create comments as themselves and cannot impersonate others or modify existing comments they don't own. This approach supports public readability while maintaining write integrity."
  }
}
